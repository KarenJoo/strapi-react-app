"use strict";(self.webpackChunkbackend=self.webpackChunkbackend||[]).push([[4869],{74869:(_s,x,s)=>{s.d(x,{M:()=>p,ProtectedEditView:()=>J});var n=s(19968),I=s(62552),U=s(48112),K=s(42816),R=s(48936),S=s(5e3),k=s(63358),N=s(28724),g=s(70996),F=s(28464),Q=s(35676),e=s(16048),V=s(53305),C=s(78164),G=s(31812),h=s(14632),z=s(48632),B=s(70516),L=s(49008),O=s(52540),W=s(14134),Y=s(71944),v=s(41268),d=s(98790),Es=s(17892),ds=s(31212),ls=s(10212),Ms=s(54320),Ps=s(5240),Os=s(91892),Ds=s(36196),Ts=s(20880),ms=s(21424),cs=s(18424),fs=s(21968),gs=s(12132),vs=s(85676),As=s(35184),Cs=s(99568),hs=s(96556),Ls=s(13192),Is=s(30840),Us=s(77784),Ks=s(79371),Rs=s(67888),Bs=s(52600),Ws=s(95752),ps=s(37388),us=s(61840),ys=s(49108),js=s(44632),xs=s(50840),Ss=s(20252),ks=s(86432),Ns=s(22612),Fs=s(24808),Qs=s(24024),Vs=s(33656),Gs=s(43280),zs=s(79804),Ys=s(19632),$s=s(29576),Hs=s(61152),Js=s(9589),Zs=s(45488),Xs=s(75516);const $=O.kt().shape({name:O.Qb().max(100).required(e.aO.required),description:O.Qb().nullable(),lifespan:O.CQ().integer().min(0).nullable().defined(e.aO.required),permissions:O.Qb().required(e.aO.required)}),H="Name already taken",p=()=>{(0,e.G0)();const{formatMessage:r}=(0,h.c)(),{lockApp:E,unlockApp:l}=(0,e.H6)(),_=(0,e.eo)(),M=(0,L.Uz)(),{state:D}=(0,L.IT)(),[o,T]=I.useState(D&&"accessKey"in D.transferToken?{...D.transferToken}:null),{trackUsage:P}=(0,e.m4)(),{setCurrentStep:b}=(0,e.sg)(),w=(0,B.w1)(W.s),{allowedActions:{canCreate:q,canUpdate:ss,canRegenerate:ns}}=(0,e.aU)(w.settings["transfer-tokens"]),ts=(0,L.SU)("/settings/transfer-tokens/:id"),{get:as,post:es,put:os}=(0,e.Qn)(),A=ts?.params?.id,i=A==="create",{formatAPIError:u}=(0,e.An)();I.useEffect(()=>{P(i?"didAddTokenFromList":"didEditTokenFromList",{tokenType:v.T})},[i,P]),(0,z.useQuery)(["transfer-token",A],async()=>{const{data:{data:t}}=await as(`/admin/transfer/tokens/${A}`);return T({...t}),t},{enabled:!i&&!o,onError(t){t instanceof C.Uh&&(t.response.data.error.details?.code==="INVALID_TOKEN_SALT"?_({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):_({type:"warning",message:u(t)}))}});const is=async(t,m)=>{P(i?"willCreateToken":"willEditToken",{tokenType:v.T}),E();const c=t.permissions.split("-");if((a=>a.length===1?a[0]==="push"||a[0]==="pull":a[0]==="push"&&a[1]==="pull")(c))try{let a;if(i){const{data:f}=await es("/admin/transfer/tokens",{...t,permissions:c});a=f.data}else{const{data:f}=await os(`/admin/transfer/tokens/${A}`,{name:t.name,description:t.description,permissions:c});a=f.data}l(),i&&(M.replace(`/settings/transfer-tokens/${a.id}`,{transferToken:a}),b("transferTokens.success")),T({...a}),_({type:"success",message:r(i?{id:"notification.success.transfertokencreated",defaultMessage:"Transfer Token successfully created"}:{id:"notification.success.transfertokenedited",defaultMessage:"Transfer Token successfully edited"})}),P(i?"didCreateToken":"didEditToken",{type:o?.permissions,tokenType:v.T})}catch(a){if(a instanceof C.Uh){const f=(0,Y.f)(a.response.data);m.setErrors(f),a?.response?.data?.error?.message===H?_({type:"warning",message:a.response.data.message||"notification.error.tokennamenotunique"}):a?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?_({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):_({type:"warning",message:a?.response?.data?.message||"notification.error"})}l()}},y=ss&&!i||q&&i;if(!i&&!o)return(0,n.jsx)(X,{});const rs=t=>{t instanceof C.Uh&&(t?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?_({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):_({type:"warning",message:u(t)}))};return(0,n.jsxs)(U.G,{children:[(0,n.jsx)(e.K8,{name:"Transfer Tokens"}),(0,n.jsx)(G.QJ,{validationSchema:$,validateOnChange:!1,initialValues:{name:o?.name||"",description:o?.description||"",lifespan:o?.lifespan??null,permissions:o?.permissions.join("-")??""},enableReinitialize:!0,onSubmit:(t,m)=>is(t,m),children:({errors:t,handleChange:m,isSubmitting:c,values:j})=>(0,n.jsxs)(e.QF,{children:[(0,n.jsx)(d.F,{backUrl:"/settings/transfer-tokens",title:{id:"Settings.transferTokens.createPage.title",defaultMessage:"TokenCreate Transfer Token"},token:o,setToken:T,canEditInputs:y,canRegenerate:ns,isSubmitting:c,regenerateUrl:"/admin/transfer/tokens/",onErrorRegenerate:rs}),(0,n.jsx)(K.S,{children:(0,n.jsxs)(R.C,{direction:"column",alignItems:"stretch",gap:6,children:[o&&Boolean(o?.name)&&"accessKey"in o&&(0,n.jsx)(d.c,{token:o.accessKey,tokenType:v.T}),(0,n.jsx)(Z,{errors:t,onChange:m,canEditInputs:y,isCreating:i,values:j,transferToken:o})]})})]})})]})},J=()=>{const r=(0,B.w1)(W.s);return(0,n.jsx)(e.rF,{permissions:r.settings?.["transfer-tokens"].read,children:(0,n.jsx)(p,{})})},Z=({errors:r={},onChange:E,canEditInputs:l,isCreating:_,values:M,transferToken:D={}})=>{const{formatMessage:o}=(0,h.c)(),T=[{value:"push",label:{id:"Settings.transferTokens.types.push",defaultMessage:"Push"}},{value:"pull",label:{id:"Settings.transferTokens.types.pull",defaultMessage:"Pull"}},{value:"push-pull",label:{id:"Settings.transferTokens.types.push-pull",defaultMessage:"Full Access"}}];return(0,n.jsx)(S.k,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,n.jsxs)(R.C,{direction:"column",alignItems:"stretch",gap:4,children:[(0,n.jsx)(k.O,{variant:"delta",as:"h2",children:o({id:"global.details",defaultMessage:"Details"})}),(0,n.jsxs)(N.y,{gap:5,children:[(0,n.jsx)(g.C,{col:6,xs:12,children:(0,n.jsx)(d.T,{error:r.name,value:M.name,canEditInputs:l,onChange:E})},"name"),(0,n.jsx)(g.C,{col:6,xs:12,children:(0,n.jsx)(d.a,{error:r.description,value:M.description,canEditInputs:l,onChange:E})},"description"),(0,n.jsx)(g.C,{col:6,xs:12,children:(0,n.jsx)(d.L,{isCreating:_,error:r.lifespan,value:M.lifespan,onChange:E,token:D})},"lifespan"),(0,n.jsx)(g.C,{col:6,xs:12,children:(0,n.jsx)(d.b,{name:"permissions",value:M.permissions,error:r.permissions,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:P=>{E({target:{name:"permissions",value:P}})},options:T,canEditInputs:l})},"permissions")]})]})})},X=({transferTokenName:r})=>{const{formatMessage:E}=(0,h.c)();return(0,e.G0)(),(0,n.jsxs)(U.G,{"aria-busy":"true",children:[(0,n.jsx)(e.K8,{name:"Transfer Tokens"}),(0,n.jsx)(F.a,{primaryAction:(0,n.jsx)(Q.Z,{disabled:!0,startIcon:(0,n.jsx)(V.c,{}),type:"button",size:"L",children:E({id:"global.save",defaultMessage:"Save"})}),title:r||E({id:"Settings.transferTokens.createPage.title",defaultMessage:"Create Transfer Token"})}),(0,n.jsx)(K.S,{children:(0,n.jsx)(e.Wm,{})})]})}}}]);
