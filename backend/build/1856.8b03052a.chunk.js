"use strict";(self.webpackChunkbackend=self.webpackChunkbackend||[]).push([[1856],{1856:(Y,P,s)=>{s.d(P,{ProtectedEditPage:()=>as});var a=s(19968),e=s(62552),d=s(48112),E=s(28464),r=s(35676),O=s(42816),I=s(5e3),p=s(48936),x=s(63358),T=s(28724),B=s(70996),j=s(5540),t=s(16048),y=s(53305),S=s(15396),Z=s(78164),D=s(31812),_=s(85676),g=s(21968),L=s(20880),R=s(14632),c=s(49008),v=s(39380),l=s(52540),C=s(10212),u=s(14134),G=s(71944),z=s(22856),o=s(73152),ds=s(54320),_s=s(5240),ls=s(91892),Es=s(36196),Ms=s(21424),cs=s(70516),ms=s(48632),Ps=s(18424),Os=s(12132),Ds=s(35184),gs=s(99568),hs=s(96556),As=s(13192),fs=s(30840),Ls=s(77784),vs=s(79371),Cs=s(67888),us=s(52600),Us=s(95752),Is=s(37388),ps=s(61840),Ts=s(49108),Bs=s(44632),Rs=s(50840),Ks=s(20252),Ws=s(86432),xs=s(22612),js=s(24808),ys=s(24024),Ss=s(33656),zs=s(43280),Qs=s(79804),Ns=s(19632),$s=s(29576),Fs=s(61152),Js=s(9589),Ys=s(45488),Zs=s(75516),Gs=s(17892),Hs=s(31212);const k=l.kt().shape({...o.C,isActive:l.SK(),roles:l.M$().min(1,t.aO.required).required(t.aO.required)}),X=["email","firstname","lastname","username","isActive","roles"],q=()=>{const{put:Q}=(0,t.Qn)(),{formatMessage:n}=(0,R.c)(),h=(0,c.SU)("/settings/users/:id")?.params?.id??"",{push:K}=(0,c.Uz)(),{setUserDisplayName:H}=(0,t.s7)(),U=(0,t.eo)(),{lockApp:ts,unlockApp:es}=(0,t.H6)(),b=(0,C.j)(z.M,async()=>(await s.e(4016).then(s.bind(s,14016))).MagicLinkEE),{formatAPIError:os}=(0,t.An)(),w=(0,C.f)(u.s),{isLoading:ns,allowedActions:{canUpdate:V}}=(0,t.aU)({read:w.settings?.users.read??[],update:w.settings?.users.update??[]});(0,t.G0)();const{users:[$],isLoading:is}=(0,C.g)({id:h},{cacheTime:0,onError(i){const{status:A}=i.response??{};A===403?(U({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}}),K("/")):U({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}});if(is||!b||ns)return(0,a.jsxs)(d.G,{"aria-busy":"true",children:[(0,a.jsx)(t.K8,{name:"Users"}),(0,a.jsx)(E.a,{primaryAction:(0,a.jsx)(r.Z,{disabled:!0,startIcon:(0,a.jsx)(y.c,{}),type:"button",size:"L",children:n({id:"global.save",defaultMessage:"Save"})}),title:n({id:"app.containers.Users.EditPage.header.label-loading",defaultMessage:"Edit user"}),navigationAction:(0,a.jsx)(j.c,{as:v.Af,startIcon:(0,a.jsx)(S.c,{}),to:"/settings/users?pageSize=10&page=1&sort=firstname",children:n({id:"global.back",defaultMessage:"Back"})})}),(0,a.jsx)(O.S,{children:(0,a.jsx)(t.Wm,{})})]});const F={...L($,X),roles:$.roles.map(({id:i})=>i),password:"",confirmPassword:""},rs=async(i,A)=>{ts?.();try{const{data:{data:M}}=await Q(`/admin/users/${h}`,g(i,"confirmPassword"));U({type:"success",message:n({id:"notification.success.saved",defaultMessage:"Saved"})});const f=t.cJ.getUserInfo();if(h.toString()===f?.id.toString()){t.cJ.setUserInfo(M);const W=_(i,"username")||(0,u.g)(i?.firstname??"",i.lastname);H(W)}A.setValues({...L(i,X),password:"",confirmPassword:""})}catch(M){if(M instanceof Z.Uh&&M.response){const f=(0,G.f)(M.response.data),W=Object.keys(f).reduce((J,m)=>(J[m]=f[m].id,J),{});A.setErrors(W),U({type:"warning",message:os(M)})}}es?.()};return(0,a.jsxs)(d.G,{children:[(0,a.jsx)(t.K8,{name:"Users"}),(0,a.jsx)(D.QJ,{onSubmit:rs,initialValues:F,validateOnChange:!1,validationSchema:k,children:({errors:i,values:A,handleChange:M,isSubmitting:f,dirty:W})=>(0,a.jsxs)(t.QF,{children:[(0,a.jsx)(E.a,{primaryAction:(0,a.jsx)(r.Z,{disabled:f||!V?!0:!W,startIcon:(0,a.jsx)(y.c,{}),loading:f,type:"submit",size:"L",children:n({id:"global.save",defaultMessage:"Save"})}),title:n({id:"app.containers.Users.EditPage.header.label",defaultMessage:"Edit {name}"},{name:F.username||(0,u.g)(F?.firstname??"",F.lastname)}),navigationAction:(0,a.jsx)(j.c,{as:v.Af,startIcon:(0,a.jsx)(S.c,{}),to:"/settings/users?pageSize=10&page=1&sort=firstname",children:n({id:"global.back",defaultMessage:"Back"})})}),(0,a.jsxs)(O.S,{children:[$?.registrationToken&&(0,a.jsx)(I.k,{paddingBottom:6,children:(0,a.jsx)(b,{registrationToken:$.registrationToken})}),(0,a.jsxs)(p.C,{direction:"column",alignItems:"stretch",gap:7,children:[(0,a.jsx)(I.k,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,a.jsxs)(p.C,{direction:"column",alignItems:"stretch",gap:4,children:[(0,a.jsx)(x.O,{variant:"delta",as:"h2",children:n({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"Details"})}),(0,a.jsx)(T.y,{gap:5,children:ss.map(J=>J.map(m=>(0,a.jsx)(B.C,{...m.size,children:(0,a.jsx)(t.u,{...m,disabled:!V,error:i[m.name],onChange:M,value:A[m.name]})},m.name)))})]})}),(0,a.jsx)(I.k,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,a.jsxs)(p.C,{direction:"column",alignItems:"stretch",gap:4,children:[(0,a.jsx)(x.O,{variant:"delta",as:"h2",children:n({id:"global.roles",defaultMessage:"User's role"})}),(0,a.jsx)(T.y,{gap:5,children:(0,a.jsx)(B.C,{col:6,xs:12,children:(0,a.jsx)(z.S,{disabled:!V,error:i.roles,onChange:M,value:A.roles})})})]})})]})]})]})})]})},ss=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.username.label",defaultMessage:"Username"},name:"username",placeholder:{id:"Auth.form.username.placeholder",defaultMessage:"e.g. Kai_Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"global.password",defaultMessage:"Password"},name:"password",type:"password",size:{col:6,xs:12},autoComplete:"new-password"},{intlLabel:{id:"Auth.form.confirmPassword.label",defaultMessage:"Password confirmation"},name:"confirmPassword",type:"password",size:{col:6,xs:12},autoComplete:"new-password"}],[{intlLabel:{id:"Auth.form.active.label",defaultMessage:"Active"},name:"isActive",type:"bool",size:{col:6,xs:12}}]],as=()=>{const Q=(0,t.eo)(),n=(0,C.f)(u.s),{isLoading:N,allowedActions:{canRead:h,canUpdate:K}}=(0,t.aU)({read:n.settings?.users.read??[],update:n.settings?.users.update??[]}),{state:H}=(0,c.IT)(),U=H?.from??"/";return e.useEffect(()=>{N||!h&&!K&&Q({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}})},[N,h,K,Q]),N?(0,a.jsx)(t.Wm,{}):!h&&!K?(0,a.jsx)(c.YJ,{to:U}):(0,a.jsx)(q,{})}},22856:(Y,P,s)=>{s.d(P,{M:()=>j,S:()=>t,a:()=>B});var a=s(19968),e=s(14632),d=s(10212),E=s(23264),r=s(5928),O=s(16048),I=s(32680),p=s(24144),x=s(48632),T=s(69372);const B=({children:D,target:_})=>{const g=(0,O.eo)(),{formatMessage:L}=(0,e.c)(),{copy:R}=(0,O.UC)(),c=L({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),v=async()=>{await R(_)&&g({type:"info",message:{id:"notification.link-copied"}})};return(0,a.jsx)(O._y,{endAction:(0,a.jsx)(E.w,{label:c,noBorder:!0,icon:(0,a.jsx)(I.c,{}),onClick:v}),title:_,titleEllipsis:!0,subtitle:D,icon:(0,a.jsx)("span",{style:{fontSize:32},children:"\u2709\uFE0F"}),iconBackground:"neutral100"})},j=({registrationToken:D})=>{const{formatMessage:_}=(0,e.c)(),g=`${window.location.origin}${(0,d.p)()}/auth/register?registrationToken=${D}`;return(0,a.jsx)(B,{target:g,children:_({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})})},t=({disabled:D,error:_,onChange:g,value:L})=>{const{get:R}=(0,O.Qn)(),{isLoading:c,data:v}=(0,x.useQuery)(["roles"],async()=>{const{data:{data:o}}=await R("/admin/roles");return o},{staleTime:5e4}),{formatMessage:l}=(0,e.c)(),C=_?l({id:_,defaultMessage:_}):"",u=l({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),G=l({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),z=l({id:"app.components.Select.placeholder",defaultMessage:"Select"});return(0,a.jsx)(r.e,{id:"roles",disabled:D,error:C,hint:G,label:u,name:"roles",onChange:o=>{g({target:{name:"roles",value:o}})},placeholder:z,startIcon:c?(0,a.jsx)(Z,{}):void 0,value:L.map(o=>o.toString()),withTags:!0,required:!0,children:(v??[]).map(o=>(0,a.jsx)(r.eI,{value:o.id.toString(),children:l({id:`global.${o.code}`,defaultMessage:o.name})},o.id))})},y=(0,T.xZ)`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,S=T.cp.div`
  animation: ${y} 2s infinite linear;
`,Z=()=>(0,a.jsx)(S,{children:(0,a.jsx)(p.c,{})})},71944:(Y,P,s)=>{s.d(P,{f:()=>a});const a=({data:e})=>{try{return Object.keys(e).reduce((d,E)=>{const r=e[E][0];return d[E]={id:r,defaultMessage:r},d},{})}catch{return{}}}},73152:(Y,P,s)=>{s.d(P,{C:()=>d});var a=s(16048),e=s(52540);const d={firstname:e.Qb().trim().required(a.aO.required),lastname:e.Qb(),email:e.Qb().email(a.aO.email).lowercase().required(a.aO.required),username:e.Qb().nullable(),password:e.Qb().min(8,a.aO.minLength).matches(/[a-z]/,"components.Input.error.contain.lowercase").matches(/[A-Z]/,"components.Input.error.contain.uppercase").matches(/\d/,"components.Input.error.contain.number"),confirmPassword:e.Qb().min(8,a.aO.minLength).oneOf([e.IL("password"),null],"components.Input.error.password.noMatch").when("password",(E,r)=>E?r.required(a.aO.required):r)}}}]);
