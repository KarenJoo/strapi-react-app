"use strict";(self.webpackChunkbackend=self.webpackChunkbackend||[]).push([[8112],{88112:(We,Z,a)=>{a.d(Z,{App:()=>Ie});var e=a(19968),f=a(49008),w=a(39380),l=a(71832),I=a(62552),Q=a(11208),X=a(2931),m=a(63358),k=a(25824),q=a(62492),ee=a(3548),B=a(35676),O=a(48936),K=a(48112),N=a(28464),se=a(65280),ae=a(23264),te=a(14448),L=a(42816),ne=a(76512),U=a(9752),ie=a(36132),re=a(28724),oe=a(70996),le=a(6496),de=a(5e3),S=a(53804),ce=a(6912),$=a(80700),ge=a(26272),_e=a(5540),t=a(16048),pe=a(89940),ue=a(71324),me=a(15396),he=a(67636),Ee=a(48636),Me=a(79848),A=a(14632),v=a(69372),J=a(31812),F=a(52540);const fe=F.kt().shape({name:F.Qb().trim().required()}).required().noUnknown(),z=({handleClose:s,handleSubmit:o,initialValues:c,isLoading:n=!1})=>{const{formatMessage:i}=(0,A.c)();return(0,e.jsxs)(Q.E,{onClose:s,labelledBy:"title",children:[(0,e.jsx)(X.k,{children:(0,e.jsx)(m.O,{id:"title",fontWeight:"bold",textColor:"neutral800",children:i({id:"content-releases.modal.add-release-title",defaultMessage:"New release"})})}),(0,e.jsx)(J.QJ,{validateOnChange:!1,onSubmit:o,initialValues:c,validationSchema:fe,children:({values:h,errors:E,handleChange:j})=>(0,e.jsxs)(J.QF,{children:[(0,e.jsx)(k.a,{children:(0,e.jsx)(q.g,{label:i({id:"content-releases.modal.form.input.label.release-name",defaultMessage:"Name"}),name:"name",value:h.name,error:E.name,onChange:j,required:!0})}),(0,e.jsx)(ee._,{startActions:(0,e.jsx)(B.Z,{onClick:s,variant:"tertiary",name:"cancel",children:i({id:"cancel",defaultMessage:"Cancel"})}),endActions:(0,e.jsx)(B.Z,{name:"submit",loading:n,disabled:!h.name,type:"submit",children:i({id:"content-releases.modal.form.button.submit",defaultMessage:"Continue"})})})]})})]})},xe=(0,v.cp)(O.C)`
  align-self: stretch;
  border-bottom-right-radius: ${({theme:s})=>s.borderRadius};
  border-bottom-left-radius: ${({theme:s})=>s.borderRadius};
  border-top: 1px solid ${({theme:s})=>s.colors.neutral150};
`,je=(0,v.cp)(O.C)`
  align-self: stretch;
  cursor: ${({disabled:s})=>s?"not-allowed":"pointer"};

  svg path {
    fill: ${({theme:s,disabled:o})=>o&&s.colors.neutral500};
  }
  span {
    color: ${({theme:s,disabled:o})=>o&&s.colors.neutral500};
  }
`,De=(0,v.cp)(pe.c)`
  width: ${({theme:s})=>s.spaces[4]};
  height: ${({theme:s})=>s.spaces[4]};
  path {
    fill: ${({theme:s})=>s.colors.neutral600};
  }
`,Pe=(0,v.cp)(ue.c)`
  width: ${({theme:s})=>s.spaces[4]};
  height: ${({theme:s})=>s.spaces[4]};
  path {
    fill: ${({theme:s})=>s.colors.danger600};
  }
`,V=({onClick:s,disabled:o,children:c})=>(0,e.jsx)(je,{paddingTop:2,paddingBottom:2,paddingLeft:4,paddingRight:4,alignItems:"center",gap:2,as:"button",hasRadius:!0,onClick:s,disabled:o,children:c}),H=({toggleEditReleaseModal:s,toggleWarningSubmit:o,children:c})=>{const{formatMessage:n}=(0,A.c)(),{releaseId:i}=(0,f.W4)(),[h,E]=I.useState(!1),j=I.useRef(null),{data:R,isLoading:x,isError:g,error:T}=(0,l.u)({id:i}),[b,{isLoading:y}]=(0,l.c)(),D=(0,t.eo)(),{formatAPIError:C}=(0,t.An)(),{allowedActions:{canUpdate:M,canDelete:p}}=(0,t.aU)(l.P),_=R?.data,d=()=>{E(W=>!W)},P=()=>{s(),d()},r=async()=>{const W=await b({id:i});"data"in W?D({type:"success",message:n({id:"content-releases.pages.ReleaseDetails.publish-notification-success",defaultMessage:"Release was published successfully."})}):(0,l.i)(W.error)?D({type:"warning",message:C(W.error)}):D({type:"warning",message:n({id:"notification.error",defaultMessage:"An error occurred"})})},u=()=>{o(),d()};if(x)return(0,e.jsx)(K.G,{"aria-busy":x,children:(0,e.jsx)(t.Wm,{})});if(g||!_)return(0,e.jsx)(f.YJ,{to:{pathname:"/plugins/content-releases",state:{errors:[{code:T?.code}]}}});const Le=_.actions.meta.count||0,ve=`${_.createdBy.firstname} ${_.createdBy.lastname}`;return(0,e.jsxs)(K.G,{"aria-busy":x,children:[(0,e.jsx)(N.a,{title:_.name,subtitle:n({id:"content-releases.pages.Details.header-subtitle",defaultMessage:"{number, plural, =0 {No entries} one {# entry} other {# entries}}"},{number:Le}),navigationAction:(0,e.jsx)(se.c,{startIcon:(0,e.jsx)(me.c,{}),to:"/plugins/content-releases",children:n({id:"global.back",defaultMessage:"Back"})}),primaryAction:!_.releasedAt&&(0,e.jsxs)(O.C,{gap:2,children:[(0,e.jsx)(ae.w,{label:n({id:"content-releases.header.actions.open-release-actions",defaultMessage:"Release actions"}),ref:j,onClick:d,children:(0,e.jsx)(he.c,{})}),h&&(0,e.jsxs)(te._k,{source:j,placement:"bottom-end",onDismiss:d,spacing:4,minWidth:"242px",children:[(0,e.jsxs)(O.C,{alignItems:"center",justifyContent:"center",direction:"column",padding:1,children:[(0,e.jsxs)(V,{disabled:!M,onClick:P,children:[(0,e.jsx)(De,{}),(0,e.jsx)(m.O,{ellipsis:!0,children:n({id:"content-releases.header.actions.edit",defaultMessage:"Edit"})})]}),(0,e.jsxs)(V,{disabled:!p,onClick:u,children:[(0,e.jsx)(Pe,{}),(0,e.jsx)(m.O,{ellipsis:!0,textColor:"danger600",children:n({id:"content-releases.header.actions.delete",defaultMessage:"Delete"})})]})]}),(0,e.jsxs)(xe,{direction:"column",justifyContent:"center",alignItems:"flex-start",gap:1,padding:5,children:[(0,e.jsx)(m.O,{variant:"pi",fontWeight:"bold",children:n({id:"content-releases.header.actions.created",defaultMessage:"Created"})}),(0,e.jsxs)(m.O,{variant:"pi",color:"neutral300",children:[(0,e.jsx)(t.od,{timestamp:new Date(_.createdAt)}),n({id:"content-releases.header.actions.created.description",defaultMessage:" by {createdBy}"},{createdBy:ve})]})]})]}),(0,e.jsx)(t.Yj,{permissions:l.P.publish,children:(0,e.jsx)(B.Z,{size:"S",variant:"default",onClick:r,loading:y,disabled:_.actions.meta.count===0,children:n({id:"content-releases.header.actions.publish",defaultMessage:"Publish"})})})]})}),c]})},Re=()=>{const{formatMessage:s}=(0,A.c)(),{releaseId:o}=(0,f.W4)(),[{query:c}]=(0,t.WK)(),n=(0,t.eo)(),{formatAPIError:i}=(0,t.An)(),{data:h,isLoading:E,isError:j,error:R}=(0,l.u)({id:o}),x=h?.data,{isLoading:g,isFetching:T,isError:b,data:y,error:D}=(0,l.d)({...c,releaseId:o}),[C]=(0,l.e)(),M=async(d,P)=>{const r=await C({params:{releaseId:o,actionId:P},body:{type:d.target.value}});"error"in r&&((0,l.i)(r.error)?n({type:"warning",message:i(r.error)}):n({type:"warning",message:s({id:"notification.error",defaultMessage:"An error occurred"})}))};if(g||E)return(0,e.jsx)(L.S,{children:(0,e.jsx)(t.Wm,{})});if(b||j||!x){const d=[];return R&&d.push({code:R.code}),D&&d.push({code:D.code}),(0,e.jsx)(f.YJ,{to:{pathname:"/plugins/content-releases",state:{errors:d}}})}const p=y?.data,_=y?.meta;return!p||!p.length?(0,e.jsx)(L.S,{children:(0,e.jsx)(t.kP,{content:{id:"content-releases.pages.Details.tab.emptyEntries",defaultMessage:"This release is empty. Open the Content Manager, select an entry and add it to the release."},action:(0,e.jsx)(ge.E,{as:w.cH,to:{pathname:"/content-manager"},style:{textDecoration:"none"},variant:"secondary",children:s({id:"content-releases.page.Details.button.openContentManager",defaultMessage:"Open the Content Manager"})})})}):(0,e.jsx)(L.S,{children:(0,e.jsxs)(O.C,{gap:4,direction:"column",alignItems:"stretch",children:[(0,e.jsx)(t.oJ.Root,{rows:p.map(d=>({...d,id:Number(d.entry.id)})),colCount:p.length,isLoading:g,isFetching:T,children:(0,e.jsxs)(t.oJ.Content,{children:[(0,e.jsxs)(t.oJ.Head,{children:[(0,e.jsx)(t.oJ.HeaderCell,{fieldSchemaType:"string",label:s({id:"content-releases.page.ReleaseDetails.table.header.label.name",defaultMessage:"name"}),name:"name"}),(0,e.jsx)(t.oJ.HeaderCell,{fieldSchemaType:"string",label:s({id:"content-releases.page.ReleaseDetails.table.header.label.locale",defaultMessage:"locale"}),name:"locale"}),(0,e.jsx)(t.oJ.HeaderCell,{fieldSchemaType:"string",label:s({id:"content-releases.page.ReleaseDetails.table.header.label.content-type",defaultMessage:"content-type"}),name:"content-type"}),(0,e.jsx)(t.oJ.HeaderCell,{fieldSchemaType:"string",label:s({id:"content-releases.page.ReleaseDetails.table.header.label.action",defaultMessage:"action"}),name:"action"})]}),(0,e.jsx)(t.oJ.LoadingBody,{}),(0,e.jsx)(t.oJ.Body,{children:p.map(({id:d,type:P,entry:r})=>(0,e.jsxs)(ne.Tr,{children:[(0,e.jsx)(U.Td,{children:(0,e.jsx)(m.O,{children:`${r.contentType.mainFieldValue||r.id}`})}),(0,e.jsx)(U.Td,{children:(0,e.jsx)(m.O,{children:`${r?.locale?.name?r.locale.name:"-"}`})}),(0,e.jsx)(U.Td,{children:(0,e.jsx)(m.O,{children:r.contentType.displayName||""})}),(0,e.jsx)(U.Td,{children:x.releasedAt?(0,e.jsx)(m.O,{children:s({id:"content-releases.page.ReleaseDetails.table.action-published",defaultMessage:"This entry was <b>{isPublish, select, true {published} other {unpublished}}</b>."},{isPublish:P==="publish",b:u=>(0,e.jsx)(m.O,{fontWeight:"bold",children:u})})}):(0,e.jsx)(l.R,{selected:P,handleChange:u=>M(u,d),name:`release-action-${d}-type`})})]},d))})]})}),(0,e.jsxs)(O.C,{paddingTop:4,alignItems:"flex-end",justifyContent:"space-between",children:[(0,e.jsx)(t.A7,{defaultValue:_?.pagination?.pageSize.toString()}),(0,e.jsx)(t.cZ,{pagination:{pageCount:_?.pagination?.pageCount||0}})]})]})})},Oe=()=>{const{formatMessage:s}=(0,A.c)(),{releaseId:o}=(0,f.W4)(),c=(0,t.eo)(),{formatAPIError:n}=(0,t.An)(),{push:i}=(0,f.Uz)(),[h,E]=I.useState(!1),[j,R]=I.useState(!1),{isLoading:x,data:g,isSuccess:T}=(0,l.u)({id:o}),[b,{isLoading:y}]=(0,l.a)(),[D,{isLoading:C}]=(0,l.b)(),M=()=>{E(r=>!r)},p=()=>R(r=>!r);if(x)return(0,e.jsx)(H,{toggleEditReleaseModal:M,toggleWarningSubmit:p,children:(0,e.jsx)(L.S,{children:(0,e.jsx)(t.Wm,{})})});const _=T&&g?.data?.name||"",d=async r=>{const u=await b({id:o,name:r.name});"data"in u?c({type:"success",message:s({id:"content-releases.modal.release-updated-notification-success",defaultMessage:"Release updated."})}):(0,l.i)(u.error)?c({type:"warning",message:n(u.error)}):c({type:"warning",message:s({id:"notification.error",defaultMessage:"An error occurred"})}),M()},P=async()=>{const r=await D({id:o});"data"in r?i("/plugins/content-releases"):(0,l.i)(r.error)?c({type:"warning",message:n(r.error)}):c({type:"warning",message:s({id:"notification.error",defaultMessage:"An error occurred"})})};return(0,e.jsxs)(H,{toggleEditReleaseModal:M,toggleWarningSubmit:p,children:[(0,e.jsx)(Re,{}),h&&(0,e.jsx)(z,{handleClose:M,handleSubmit:d,isLoading:x||y,initialValues:{name:_||""}}),(0,e.jsx)(t.cz,{bodyText:{id:"content-releases.dialog.confirmation-message",defaultMessage:"Are you sure you want to delete this release?"},isOpen:j,isConfirmButtonLoading:C,onToggleDialog:p,onConfirm:P})]})},ye=()=>(0,e.jsx)(t.Yj,{permissions:l.P.main,children:(0,e.jsx)(Oe,{})}),Y=({isLoading:s,totalReleases:o,onClickAddRelease:c,children:n})=>{const{formatMessage:i}=(0,A.c)();return(0,e.jsxs)(K.G,{"aria-busy":s,children:[(0,e.jsx)(N.a,{title:i({id:"content-releases.pages.Releases.title",defaultMessage:"Releases"}),subtitle:!s&&i({id:"content-releases.pages.Releases.header-subtitle",defaultMessage:"{number, plural, =0 {No releases} one {# release} other {# releases}}"},{number:o}),primaryAction:(0,e.jsx)(t.Yj,{permissions:l.P.create,children:(0,e.jsx)(B.Z,{startIcon:(0,e.jsx)(Ee.c,{}),onClick:c,children:i({id:"content-releases.header.actions.add-release",defaultMessage:"New release"})})})}),n]})},Ce=(0,v.cp)(_e.c)`
  display: block;
`,G=({sectionTitle:s,releases:o=[],isError:c=!1})=>{const{formatMessage:n}=(0,A.c)();return c?(0,e.jsx)(t.wF,{}):o?.length===0?(0,e.jsx)(ie.S,{content:n({id:"content-releases.page.Releases.tab.emptyEntries",defaultMessage:"No releases"},{target:s}),icon:(0,e.jsx)(Me.c,{width:"10rem"})}):(0,e.jsx)(re.y,{gap:4,children:o.map(({id:i,name:h,actions:E})=>(0,e.jsx)(oe.C,{col:3,s:6,xs:12,children:(0,e.jsx)(Ce,{href:`content-releases/${i}`,isExternal:!1,children:(0,e.jsxs)(O.C,{direction:"column",justifyContent:"space-between",padding:4,hasRadius:!0,background:"neutral0",shadow:"tableShadow",height:"100%",width:"100%",alignItems:"start",gap:2,children:[(0,e.jsx)(m.O,{as:"h3",variant:"delta",fontWeight:"bold",children:h}),(0,e.jsx)(m.O,{variant:"pi",children:n({id:"content-releases.page.Releases.release-item.entries",defaultMessage:"{number, plural, =0 {No entries} one {# entry} other {# entries}}"},{number:E.meta.count})})]})})},i))})},Ae={name:""},Te=()=>{const s=(0,f.IT)(),[o,c]=I.useState(!1),n=(0,t.eo)(),{formatMessage:i}=(0,A.c)(),{push:h,replace:E}=(0,f.Uz)(),{formatAPIError:j}=(0,t.An)(),[{query:R},x]=(0,t.WK)(),g=(0,l.f)(R),[T,{isLoading:b}]=(0,l.g)(),{isLoading:y,isSuccess:D,isError:C}=g;I.useEffect(()=>{s?.state?.errors&&(n({type:"warning",title:i({id:"content-releases.pages.Releases.notification.error.title",defaultMessage:"Your request could not be processed."}),message:i({id:"content-releases.pages.Releases.notification.error.message",defaultMessage:"Please try again or open another release."})}),E({state:null}))},[i,s?.state?.errors,E,n]);const M=()=>{c(r=>!r)};if(y)return(0,e.jsx)(Y,{onClickAddRelease:M,isLoading:!0,children:(0,e.jsx)(L.S,{children:(0,e.jsx)(t.Wm,{})})});const p=D&&g.currentData?.meta?.pagination?.total||0,_=r=>{x({...R,page:1,pageSize:g?.currentData?.meta?.pagination?.pageSize||16,filters:{releasedAt:{$notNull:r!==0}}})},d=g?.currentData?.meta?.activeTab||"pending",P=async r=>{const u=await T({name:r.name});"data"in u?(n({type:"success",message:i({id:"content-releases.modal.release-created-notification-success",defaultMessage:"Release created."})}),h(`/plugins/content-releases/${u.data.data.id}`)):(0,l.i)(u.error)?n({type:"warning",message:j(u.error)}):n({type:"warning",message:i({id:"notification.error",defaultMessage:"An error occurred"})})};return(0,e.jsxs)(Y,{onClickAddRelease:M,totalReleases:p,children:[(0,e.jsx)(L.S,{children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(le.M,{label:i({id:"content-releases.pages.Releases.tab-group.label",defaultMessage:"Releases list"}),variant:"simple",initialSelectedTabIndex:["pending","done"].indexOf(d),onTabChange:_,children:[(0,e.jsxs)(de.k,{paddingBottom:8,children:[(0,e.jsxs)(S.k,{children:[(0,e.jsx)(S.s,{children:i({id:"content-releases.pages.Releases.tab.pending",defaultMessage:"Pending"})}),(0,e.jsx)(S.s,{children:i({id:"content-releases.pages.Releases.tab.done",defaultMessage:"Done"})})]}),(0,e.jsx)(ce.c,{})]}),(0,e.jsxs)($.o,{children:[(0,e.jsx)($.G,{children:(0,e.jsx)(G,{sectionTitle:"pending",releases:g?.currentData?.data,isError:C})}),(0,e.jsx)($.G,{children:(0,e.jsx)(G,{sectionTitle:"done",releases:g?.currentData?.data,isError:C})})]})]}),p>0&&(0,e.jsxs)(O.C,{paddingTop:4,alignItems:"flex-end",justifyContent:"space-between",children:[(0,e.jsx)(t.A7,{options:["8","16","32","64"],defaultValue:g?.currentData?.meta?.pagination?.pageSize.toString()}),(0,e.jsx)(t.cZ,{pagination:{pageCount:g?.currentData?.meta?.pagination?.pageCount||0}})]})]})}),o&&(0,e.jsx)(z,{handleClose:M,handleSubmit:P,isLoading:b,initialValues:Ae})]})},be=()=>(0,e.jsx)(t.Yj,{permissions:l.P.main,children:(0,e.jsx)(Te,{})}),Ie=()=>(0,e.jsxs)(f.Wk,{children:[(0,e.jsx)(f.kX,{exact:!0,path:`/plugins/${l.p}`,component:be}),(0,e.jsx)(f.kX,{exact:!0,path:`/plugins/${l.p}/:releaseId`,component:ye})]})}}]);
