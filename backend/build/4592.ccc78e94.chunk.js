"use strict";(self.webpackChunkbackend=self.webpackChunkbackend||[]).push([[4592],{49764:(Y,f,t)=>{t.d(f,{F:()=>O});var s=t(19968),u=t(62552),I=t(5e3),h=t(35676),g=t(16048),R=t(60012),P=t(14632);const O=({displayedFilters:C})=>{const[A,B]=u.useState(!1),{formatMessage:y}=(0,P.c)(),c=u.useRef(null),T=()=>{B(K=>!K)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(I.k,{paddingTop:1,paddingBottom:1,children:[(0,s.jsx)(h.Z,{variant:"tertiary",ref:c,startIcon:(0,s.jsx)(R.c,{}),onClick:T,size:"S",children:y({id:"app.utils.filters",defaultMessage:"Filters"})}),A&&(0,s.jsx)(g.SI,{displayedFilters:C,isVisible:A,onToggle:T,source:c})]}),(0,s.jsx)(g.aW,{filtersSchema:C})]})}},54592:(Y,f,t)=>{t.d(f,{ProtectedAuditLogsListPage:()=>lt});var s=t(19968),u=t(11208),I=t(2931),h=t(25824),g=t(48936),R=t(89296),P=t(5e3),O=t(63358),C=t(28724),A=t(26852),B=t(48744),y=t(76512),c=t(9752),T=t(23264),K=t(65092),Z=t(9544),J=t(20596),S=t(42816),H=t(48112),X=t(28464),b=t(52051),r=t(16048),L=t(14632),F=t(70516),k=t(49764),N=t(14134),w=t(5848),q=t(39820),$=t(48632),tt=t(27860),st=t(14032),W=t(33104),et=t(49008),at=t(10212),Et=t(62552),mt=t(17892),Mt=t(31212),Dt=t(35184),gt=t(85676),Ot=t(96556),Pt=t(54320),ct=t(5240),Lt=t(91892),ut=t(36196),Ct=t(20880),At=t(21424),Tt=t(31812),Ut=t(18424),vt=t(52540),pt=t(21968),ft=t(12132),It=t(99568),ht=t(13192),Rt=t(30840),Bt=t(77784),yt=t(79371),Kt=t(67888),Wt=t(52600),jt=t(95752),xt=t(37388),St=t(61840),Ft=t(49108),Nt=t(44632),$t=t(50840),Vt=t(20252),Qt=t(86432),zt=t(22612),Gt=t(24808),Yt=t(24024),Zt=t(33656),Jt=t(43280),Ht=t(79804),Xt=t(19632),bt=t(29576),kt=t(61152),wt=t(9589),qt=t(45488),ts=t(75516);const V=()=>{const{formatDate:e}=(0,L.c)();return l=>{const n=(0,tt.c)(l),_=e(n,{dateStyle:"long"}),i=e(n,{timeStyle:"medium",hourCycle:"h24"});return`${_}, ${i}`}},Q={"entry.create":"Create entry{model, select, undefined {} other { ({model})}}","entry.update":"Update entry{model, select, undefined {} other { ({model})}}","entry.delete":"Delete entry{model, select, undefined {} other { ({model})}}","entry.publish":"Publish entry{model, select, undefined {} other { ({model})}}","entry.unpublish":"Unpublish entry{model, select, undefined {} other { ({model})}}","media.create":"Create media","media.update":"Update media","media.delete":"Delete media","media-folder.create":"Create media folder","media-folder.update":"Update media folder","media-folder.delete":"Delete media folder","user.create":"Create user","user.update":"Update user","user.delete":"Delete user","admin.auth.success":"Admin login","admin.logout":"Admin logout","content-type.create":"Create content type","content-type.update":"Update content type","content-type.delete":"Delete content type","component.create":"Create component","component.update":"Update component","component.delete":"Delete component","role.create":"Create role","role.update":"Update role","role.delete":"Delete role","permission.create":"Create permission","permission.update":"Update permission","permission.delete":"Delete permission"},j=e=>Q[e]||e,nt=({handleClose:e,logId:d})=>{const{get:l}=(0,r.Qn)(),n=(0,r.eo)(),_=async M=>{const{data:m}=await l(`/admin/audit-logs/${M}`);if(!m)throw new Error("Audit log not found");return m},{data:i,status:a}=(0,$.useQuery)(["audit-log",d],()=>_(d),{onError(){n({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),e()}}),o=V(),E=i&&"date"in i?o(i.date):"";return(0,s.jsxs)(u.E,{onClose:e,labelledBy:"title",children:[(0,s.jsx)(I.k,{children:(0,s.jsx)(w.M,{label:E,id:"title",children:(0,s.jsx)(q.i,{isCurrent:!0,children:E})})}),(0,s.jsx)(h.a,{children:(0,s.jsx)(it,{status:a,data:i,formattedDate:E})})]})},it=({status:e,data:d,formattedDate:l})=>{const{formatMessage:n}=(0,L.c)();if(e==="loading")return(0,s.jsx)(g.C,{padding:7,justifyContent:"center",alignItems:"center",children:(0,s.jsx)(R.c,{children:"Loading content..."})});const{action:_,user:i,payload:a}=d;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(P.k,{marginBottom:3,children:(0,s.jsx)(O.O,{variant:"delta",id:"title",children:n({id:"Settings.permissions.auditLogs.details",defaultMessage:"Log Details"})})}),(0,s.jsxs)(C.y,{gap:4,gridCols:2,paddingTop:4,paddingBottom:4,paddingLeft:6,paddingRight:6,marginBottom:4,background:"neutral100",hasRadius:!0,children:[(0,s.jsx)(U,{actionLabel:n({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),actionName:n({id:`Settings.permissions.auditLogs.${_}`,defaultMessage:j(_)},{model:a?.model})}),(0,s.jsx)(U,{actionLabel:n({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"}),actionName:l}),(0,s.jsx)(U,{actionLabel:n({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),actionName:i?.displayName||"-"}),(0,s.jsx)(U,{actionLabel:n({id:"Settings.permissions.auditLogs.userId",defaultMessage:"User ID"}),actionName:i?.id.toString()||"-"})]}),(0,s.jsx)(A.O,{value:JSON.stringify(a,null,2),disabled:!0,label:n({id:"Settings.permissions.auditLogs.payload",defaultMessage:"Payload"})})]})},U=({actionLabel:e,actionName:d})=>(0,s.jsxs)(g.C,{direction:"column",alignItems:"baseline",gap:1,children:[(0,s.jsx)(O.O,{textColor:"neutral600",variant:"sigma",children:e}),(0,s.jsx)(O.O,{textColor:"neutral600",children:d})]}),ot=({pagination:e}={pagination:{page:1,pageCount:0,pageSize:50,total:0}})=>(0,s.jsx)(P.k,{paddingTop:4,children:(0,s.jsxs)(g.C,{alignItems:"flex-end",justifyContent:"space-between",children:[(0,s.jsx)(r.A7,{}),(0,s.jsx)(r.cZ,{pagination:e})]})}),x=({headers:e,rows:d,onOpenModal:l})=>{const{formatMessage:n}=(0,L.c)(),_=V(),i=({type:a,value:o,model:E})=>a==="date"?_(o):a==="action"?n({id:`Settings.permissions.auditLogs.${o}`,defaultMessage:j(o)},{model:E}):o||"-";return(0,s.jsx)(B.K,{children:d.map(a=>(0,s.jsxs)(y.Tr,{...(0,r.on)({fn:()=>l(a.id)}),children:[e?.map(({key:o,name:E,cellFormatter:M})=>{const m=a[E];return(0,s.jsx)(c.Td,{children:(0,s.jsx)(O.O,{textColor:"neutral800",children:i({type:o,value:M?M(m):m,model:a.payload?.model})})},o)}),(0,s.jsx)(c.Td,{...r.Ii,children:(0,s.jsx)(g.C,{justifyContent:"end",children:(0,s.jsx)(T.w,{onClick:()=>l(a.id),"aria-label":n({id:"app.component.table.view",defaultMessage:"{target} details"},{target:`${a.action} action`}),noBorder:!0,icon:(0,s.jsx)(st.c,{})})})})]},a.id))})};x.defaultProps={rows:[]},x.propTypes={headers:W.array.isRequired,rows:W.array,onOpenModal:W.func.isRequired};const dt=({canReadAuditLogs:e,canReadUsers:d})=>{const{get:l}=(0,r.Qn)(),{search:n}=(0,et.IT)(),_=(0,r.eo)(),[{query:i}]=(0,r.WK)(),a={keepPreviousData:!0,retry:!1,staleTime:1e3*20,onError:D=>_({type:"warning",message:D.message})},{users:o,isError:E,isLoading:M}=(0,at.g)({},{...a,enabled:d,staleTime:2*(1e3*60)}),{data:m,isLoading:v,isError:p}=(0,$.useQuery)(["auditLogs",n],async()=>{const{data:D}=await l("/admin/audit-logs",{params:i});return D},{...a,enabled:e});return{auditLogs:m,users:o,isLoading:M||v,hasError:p||E}},z=({value:e,options:d,onChange:l}={value:void 0})=>{const{formatMessage:n}=(0,L.c)(),_=n({id:"Settings.permissions.auditLogs.filter.aria-label",defaultMessage:"Search and select an option to filter"});return(0,s.jsx)(K.k1,{"aria-label":_,value:e,onChange:l,children:d?.map(({label:i,customValue:a})=>(0,s.jsx)(Z.m,{value:a,children:i},a))})},G=[{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"},value:"$eq"},{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"},value:"$ne"}],_t=({formatMessage:e,users:d,canReadUsers:l})=>{const n=Object.keys(Q).map(i=>({label:e({id:`Settings.permissions.auditLogs.${i}`,defaultMessage:j(i)},{model:void 0}),customValue:i})),_=[{name:"action",metadatas:{customOperators:G,label:e({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),customInput:z,options:n},fieldSchema:{type:"enumeration"}},{name:"date",metadatas:{label:e({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"})},fieldSchema:{type:"datetime"}}];if(l&&d){const i=o=>o.username?o.username:o.firstname&&o.lastname?e({id:"Settings.permissions.auditLogs.user.fullname",defaultMessage:"{firstname} {lastname}"},{firstname:o.firstname,lastname:o.lastname}):o.email,a=d.map(o=>({label:i(o),customValue:o.id.toString()}));return[..._,{name:"user",metadatas:{customOperators:G,label:e({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),options:a,customInput:z},fieldSchema:{type:"relation",mainField:{name:"id"}}}]}return _},rt=()=>{const{formatMessage:e}=(0,L.c)(),d=(0,F.w1)(N.s),{allowedActions:{canRead:l,canReadUsers:n}}=(0,r.aU)({...d.settings?.auditLogs,readUsers:d.settings?.users.read||[]}),[{query:_},i]=(0,r.WK)(),{auditLogs:a,users:o,isLoading:E,hasError:M}=dt({canReadAuditLogs:l,canReadUsers:n});(0,r.G0)();const m=_t({formatMessage:e,users:o,canReadUsers:n}),v=e({id:"global.auditLogs",defaultMessage:"Audit Logs"}),p=[{name:"action",key:"action",metadatas:{label:e({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),sortable:!0}},{name:"date",key:"date",metadatas:{label:e({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"}),sortable:!0}},{key:"user",name:"user",metadatas:{label:e({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),sortable:!1},cellFormatter:D=>D?D.displayName:""}];return M?(0,s.jsx)(J._,{children:(0,s.jsx)(S.S,{children:(0,s.jsx)(P.k,{paddingTop:8,children:(0,s.jsx)(r.wF,{})})})}):(0,s.jsxs)(H.G,{"aria-busy":E,children:[(0,s.jsx)(r.K8,{name:v}),(0,s.jsx)(X.a,{title:v,subtitle:e({id:"Settings.permissions.auditLogs.listview.header.subtitle",defaultMessage:"Logs of all the activities that happened in your environment"})}),(0,s.jsx)(b.U,{startActions:(0,s.jsx)(k.F,{displayedFilters:m})}),(0,s.jsxs)(S.S,{children:[(0,s.jsx)(r.AL,{contentType:"Audit logs",headers:p,rows:a?.results||[],withBulkActions:!0,isLoading:E,children:(0,s.jsx)(x,{headers:p,rows:a?.results||[],onOpenModal:D=>i({id:`${D}`})})}),a?.pagination&&(0,s.jsx)(ot,{pagination:a.pagination})]}),_?.id&&(0,s.jsx)(nt,{handleClose:()=>i({id:null},"remove"),logId:_.id})]})},lt=()=>{const e=(0,F.w1)(N.s);return(0,s.jsx)(r.rF,{permissions:e.settings?.auditLogs?.main,children:(0,s.jsx)(rt,{})})}}}]);
