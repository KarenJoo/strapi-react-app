"use strict";(self.webpackChunkbackend=self.webpackChunkbackend||[]).push([[9532],{49764:(os,b,s)=>{s.d(b,{F:()=>M});var t=s(19968),E=s(62552),A=s(5e3),V=s(35676),U=s(16048),f=s(60012),g=s(14632);const M=({displayedFilters:c})=>{const[L,u]=E.useState(!1),{formatMessage:Z}=(0,g.c)(),S=E.useRef(null),F=()=>{u(R=>!R)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(A.k,{paddingTop:1,paddingBottom:1,children:[(0,t.jsx)(V.Z,{variant:"tertiary",ref:S,startIcon:(0,t.jsx)(f.c,{}),onClick:F,size:"S",children:Z({id:"app.utils.filters",defaultMessage:"Filters"})}),L&&(0,t.jsx)(U.SI,{displayedFilters:c,isVisible:L,onToggle:F,source:S})]}),(0,t.jsx)(U.aW,{filtersSchema:c})]})}},71912:(os,b,s)=>{s.d(b,{C:()=>_s,ProtectedListPage:()=>xs});var t=s(19968),E=s(62552),A=s(35676),V=s(11208),U=s(2931),f=s(25824),g=s(48936),M=s(5e3),c=s(63358),L=s(28724),u=s(70996),Z=s(3548),S=s(48744),F=s(76512),R=s(9752),ns=s(19576),v=s(23264),O=s(48112),x=s(28464),Y=s(52051),H=s(42816),e=s(16048),G=s(12132),m=s(14632),J=s(48632),w=s(70516),q=s(49008),I=s(10212),l=s(14134),ms=s(49764),Ms=s(92508),cs=s(89940),Os=s(71324),Ds=s(5848),Ps=s(39820),gs=s(78164),hs=s(31812),X=s(52540),ls=s(22856),js=s(54320),ys=s(5240),Ks=s(91892),Ws=s(36196),ps=s(20880),Ss=s(21424),Fs=s(18424),Qs=s(21968),$s=s(85676),zs=s(35184),Ns=s(99568),bs=s(96556),Vs=s(13192),Zs=s(30840),Ys=s(77784),Hs=s(79371),Gs=s(67888),Js=s(52600),Xs=s(95752),ks=s(37388),ws=s(61840),qs=s(49108),st=s(44632),tt=s(50840),et=s(20252),at=s(86432),nt=s(22612),it=s(24808),ot=s(24024),lt=s(33656),rt=s(43280),dt=s(79804),_t=s(19632),Et=s(29576),mt=s(61152),Mt=s(9589),ct=s(45488),Ot=s(75516),Dt=s(17892),Pt=s(31212);const Cs=({onClick:n})=>{const{formatMessage:r}=(0,m.c)();return(0,t.jsx)(A.Z,{onClick:n,startIcon:(0,t.jsx)(Ms.c,{}),size:"S",children:r({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"})})},As=({onSuccess:n,onToggle:r})=>{const[D,Q]=E.useState("create"),[B,$]=E.useState(!1),[j,T]=E.useState(""),{formatMessage:d}=(0,m.c)(),y=(0,e.eo)(),{lockApp:_,unlockApp:a}=(0,e.H6)(),{post:z}=(0,e.Qn)(),{formatAPIError:h}=(0,e.An)(),N=(0,I.j)(fs,async()=>(await s.e(1120).then(s.bind(s,41120))).ROLE_LAYOUT,{combine(o,C){return[...o,...C]},defaultValue:[]}),K=(0,I.j)(rs,async()=>(await s.e(1120).then(s.bind(s,41120))).FORM_INITIAL_VALUES,{combine(o,C){return{...o,...C}},defaultValue:rs}),W=(0,I.j)(ls.M,async()=>(await s.e(4016).then(s.bind(s,14016))).MagicLinkEE),ss=(0,J.useMutation)(o=>z("/admin/users",o),{onMutate(){_&&_(),$(!0)},async onSuccess({data:{data:o}}){o.registrationToken?(T(o.registrationToken),await n(),as()):y({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})},onError(o){throw y({type:"warning",message:h(o)}),o},onSettled(){a&&a(),$(!1)}}),ts=d({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"}),es=async(o,{setErrors:C})=>{try{await ss.mutateAsync({...o,roles:o.roles??[]})}catch(p){p instanceof gs.Uh&&p.response?.data?.error.message==="Email already taken"&&C({email:p.response.data.error.message})}},as=()=>{Es?Q(Es):r()},{buttonSubmitLabel:k,isDisabled:i,next:Es}=vs[D],Bs=D==="create"?(0,t.jsx)(A.Z,{type:"submit",loading:B,children:d(k)}):(0,t.jsx)(A.Z,{type:"button",loading:B,onClick:r,children:d(k)});return W?(0,t.jsxs)(V.E,{onClose:r,labelledBy:"title",children:[(0,t.jsx)(U.k,{children:(0,t.jsx)(Ds.M,{label:ts,children:(0,t.jsx)(Ps.i,{isCurrent:!0,children:ts})})}),(0,t.jsx)(hs.QJ,{enableReinitialize:!0,initialValues:K??{},onSubmit:es,validationSchema:us,validateOnChange:!1,children:({errors:o,handleChange:C,values:p})=>(0,t.jsxs)(e.QF,{children:[(0,t.jsx)(f.a,{children:(0,t.jsxs)(g.C,{direction:"column",alignItems:"stretch",gap:6,children:[D!=="create"&&(0,t.jsx)(W,{registrationToken:j}),(0,t.jsxs)(M.k,{children:[(0,t.jsx)(c.O,{variant:"beta",as:"h2",children:d({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"User details"})}),(0,t.jsx)(M.k,{paddingTop:4,children:(0,t.jsx)(g.C,{direction:"column",alignItems:"stretch",gap:1,children:(0,t.jsx)(L.y,{gap:5,children:Ls.map(is=>is.map(P=>(0,t.jsx)(u.C,{...P.size,children:(0,t.jsx)(e.u,{...P,disabled:i,error:o[P.name],onChange:C,value:p[P.name]})},P.name)))})})})]}),(0,t.jsxs)(M.k,{children:[(0,t.jsx)(c.O,{variant:"beta",as:"h2",children:d({id:"global.roles",defaultMessage:"User's role"})}),(0,t.jsx)(M.k,{paddingTop:4,children:(0,t.jsxs)(L.y,{gap:5,children:[(0,t.jsx)(u.C,{col:6,xs:12,children:(0,t.jsx)(ls.S,{disabled:i,error:o.roles,onChange:C,value:p.roles??[]})}),N.map(is=>is.map(P=>(0,t.jsx)(u.C,{...P.size,children:(0,t.jsx)(e.u,{...P,disabled:i,onChange:C,value:p[P.name]})},P.name)))]})})]})]})}),(0,t.jsx)(Z._,{startActions:(0,t.jsx)(A.Z,{variant:"tertiary",onClick:r,type:"button",children:d({id:"app.components.Button.cancel",defaultMessage:"Cancel"})}),endActions:Bs})]})})]}):null},rs={firstname:"",lastname:"",email:"",roles:[]},fs=[],Ls=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0}]],us=X.kt().shape({firstname:X.Qb().trim().required(e.aO.required),lastname:X.Qb(),email:X.Qb().email(e.aO.email).required(e.aO.required),roles:X.M$().min(1,e.aO.required).required(e.aO.required)}),vs={create:{buttonSubmitLabel:{id:"app.containers.Users.ModalForm.footer.button-success",defaultMessage:"Invite user"},isDisabled:!1,next:"magic-link"},"magic-link":{buttonSubmitLabel:{id:"global.finish",defaultMessage:"Finish"},isDisabled:!0,next:null}},Is=({canDelete:n,headers:r=[],entriesToDelete:D=[],onClickDelete:Q,onSelectRow:B,withMainAction:$,withBulkActions:j,rows:T=[]})=>{const{push:d,location:{pathname:y}}=(0,q.Uz)(),{formatMessage:_}=(0,m.c)();return(0,t.jsx)(S.K,{children:T.map(a=>{const z=D.findIndex(h=>h===a.id)!==-1;return(0,t.jsxs)(F.Tr,{...(0,e.on)({fn:()=>d(`${y}/${a.id}`),condition:j}),children:[$&&(0,t.jsx)(R.Td,{...e.Ii,children:(0,t.jsx)(ns.c,{"aria-label":_({id:"app.component.table.select.one-entry",defaultMessage:"Select {target}"},{target:(0,l.g)(a?.firstname??"",a.lastname)}),checked:z,onChange:()=>{B&&B({name:a.id,value:!z})}})}),r.map(({key:h,cellFormatter:N,name:K,...W})=>(0,t.jsx)(R.Td,{children:typeof N=="function"?N(a,{key:h,name:K,formatMessage:_,...W}):(0,t.jsx)(c.O,{textColor:"neutral800",children:a[K]||"-"})},h)),j&&(0,t.jsx)(R.Td,{children:(0,t.jsxs)(g.C,{justifyContent:"end",children:[(0,t.jsx)(v.w,{onClick:()=>d(`${y}/${a.id}`),label:_({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:(0,l.g)(a.firstname??"",a.lastname)}),noBorder:!0,icon:(0,t.jsx)(cs.c,{})}),n&&(0,t.jsx)(M.k,{paddingLeft:1,...e.Ii,children:(0,t.jsx)(v.w,{onClick:()=>{Q&&Q(a.id)},label:_({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:(0,l.g)(a.firstname??"",a.lastname)}),noBorder:!0,icon:(0,t.jsx)(Os.c,{})})})]})})]},a.id)})})},ds=["ee","license-limit-info"],_s=()=>{const{post:n}=(0,e.Qn)(),{formatAPIError:r}=(0,e.An)(),[D,Q]=E.useState(!1),B=(0,w.w1)(l.s),{allowedActions:{canCreate:$,canDelete:j,canRead:T}}=(0,e.aU)(B.settings?.users),d=(0,J.useQueryClient)(),y=(0,e.eo)(),{formatMessage:_}=(0,m.c)(),{search:a}=(0,q.IT)();(0,e.G0)();const{users:z,pagination:h,isError:N,isLoading:K,refetch:W}=(0,I.g)(G.parse(a,{ignoreQueryPrefix:!0}),{cacheTime:0,enabled:T}),ss=(0,I.j)(Cs,async()=>(await s.e(3540).then(s.bind(s,83540))).CreateActionEE),ts=Ts.map(i=>({...i,metadatas:{...i.metadatas,label:_(i.metadatas.label)}})),es=_({id:"global.users",defaultMessage:"Users"}),as=()=>{Q(i=>!i)},k=(0,J.useMutation)(async i=>n("/admin/users/batch-delete",{ids:i}),{async onSuccess(){await W(),await d.refetchQueries(ds)},onError(i){y({type:"warning",message:r(i)})}});return ss?(0,t.jsxs)(O.G,{"aria-busy":K,children:[(0,t.jsx)(e.K8,{name:"Users"}),(0,t.jsx)(x.a,{primaryAction:$&&(0,t.jsx)(ss,{onClick:as}),title:es,subtitle:_({id:"Settings.permissions.users.listview.header.subtitle",defaultMessage:"All the users who have access to the Strapi admin panel"})}),T&&(0,t.jsx)(Y.U,{startActions:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.w9,{label:_({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:es})}),(0,t.jsx)(ms.F,{displayedFilters:Us})]})}),(0,t.jsxs)(H.S,{children:[!T&&(0,t.jsx)(e.o5,{}),N&&(0,t.jsx)("div",{children:"TODO: An error occurred"}),T&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.AL,{contentType:"Users",isLoading:K,onConfirmDeleteAll:async i=>{await k.mutateAsync(i)},onConfirmDelete:async i=>{await k.mutateAsync([i])},headers:ts,rows:z,withBulkActions:!0,withMainAction:j,children:(0,t.jsx)(Is,{canDelete:j})}),h&&(0,t.jsx)(M.k,{paddingTop:4,children:(0,t.jsxs)(g.C,{alignItems:"flex-end",justifyContent:"space-between",children:[(0,t.jsx)(e.A7,{}),(0,t.jsx)(e.cZ,{pagination:h})]})})]})]}),D&&(0,t.jsx)(As,{onSuccess:async()=>{await W(),await d.refetchQueries(ds)},onToggle:as})]}):null},Ts=[{name:"firstname",key:"firstname",metadatas:{label:{id:"Settings.permissions.users.firstname",defaultMessage:"Firstname"},sortable:!0}},{name:"lastname",key:"lastname",metadatas:{label:{id:"Settings.permissions.users.lastname",defaultMessage:"Lastname"},sortable:!0}},{key:"email",name:"email",metadatas:{label:{id:"Settings.permissions.users.email",defaultMessage:"Email"},sortable:!0}},{key:"roles",name:"roles",metadatas:{label:{id:"Settings.permissions.users.roles",defaultMessage:"Roles"},sortable:!1},cellFormatter({roles:n},{formatMessage:r}){return(0,t.jsx)(c.O,{textColor:"neutral800",children:n.map(D=>r({id:`Settings.permissions.users.${D.code}`,defaultMessage:D.name})).join(`,
`)})}},{key:"username",name:"username",metadatas:{label:{id:"Settings.permissions.users.username",defaultMessage:"Username"},sortable:!0}},{key:"isActive",name:"isActive",metadatas:{label:{id:"Settings.permissions.users.user-status",defaultMessage:"User status"},sortable:!1},cellFormatter({isActive:n},{formatMessage:r}){return(0,t.jsxs)(g.C,{children:[(0,t.jsx)(e.sD,{variant:n?"success":"danger"}),(0,t.jsx)(c.O,{textColor:"neutral800",children:r({id:n?"Settings.permissions.users.active":"Settings.permissions.users.inactive",defaultMessage:n?"Active":"Inactive"})})]})}}],Us=[{name:"firstname",metadatas:{label:"Firstname"},fieldSchema:{type:"string"}},{name:"lastname",metadatas:{label:"Lastname"},fieldSchema:{type:"string"}},{name:"email",metadatas:{label:"Email"},fieldSchema:{type:"email"}},{name:"username",metadatas:{label:"Username"},fieldSchema:{type:"string"}},{name:"isActive",metadatas:{label:"Active user"},fieldSchema:{type:"boolean"}}],Rs=()=>{const n=(0,I.j)(_s,async()=>(await s.e(8668).then(s.bind(s,48668))).UserListPageEE);return n?(0,t.jsx)(n,{}):null},xs=()=>{const n=(0,w.w1)(l.s);return(0,t.jsx)(e.rF,{permissions:n.settings?.users.main,children:(0,t.jsx)(Rs,{})})}},22856:(os,b,s)=>{s.d(b,{M:()=>Z,S:()=>S,a:()=>u});var t=s(19968),E=s(14632),A=s(10212),V=s(23264),U=s(5928),f=s(16048),g=s(32680),M=s(24144),c=s(48632),L=s(69372);const u=({children:v,target:O})=>{const x=(0,f.eo)(),{formatMessage:Y}=(0,E.c)(),{copy:H}=(0,f.UC)(),e=Y({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),G=async()=>{await H(O)&&x({type:"info",message:{id:"notification.link-copied"}})};return(0,t.jsx)(f._y,{endAction:(0,t.jsx)(V.w,{label:e,noBorder:!0,icon:(0,t.jsx)(g.c,{}),onClick:G}),title:O,titleEllipsis:!0,subtitle:v,icon:(0,t.jsx)("span",{style:{fontSize:32},children:"\u2709\uFE0F"}),iconBackground:"neutral100"})},Z=({registrationToken:v})=>{const{formatMessage:O}=(0,E.c)(),x=`${window.location.origin}${(0,A.p)()}/auth/register?registrationToken=${v}`;return(0,t.jsx)(u,{target:x,children:O({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})})},S=({disabled:v,error:O,onChange:x,value:Y})=>{const{get:H}=(0,f.Qn)(),{isLoading:e,data:G}=(0,c.useQuery)(["roles"],async()=>{const{data:{data:l}}=await H("/admin/roles");return l},{staleTime:5e4}),{formatMessage:m}=(0,E.c)(),J=O?m({id:O,defaultMessage:O}):"",w=m({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),q=m({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),I=m({id:"app.components.Select.placeholder",defaultMessage:"Select"});return(0,t.jsx)(U.e,{id:"roles",disabled:v,error:J,hint:q,label:w,name:"roles",onChange:l=>{x({target:{name:"roles",value:l}})},placeholder:I,startIcon:e?(0,t.jsx)(ns,{}):void 0,value:Y.map(l=>l.toString()),withTags:!0,required:!0,children:(G??[]).map(l=>(0,t.jsx)(U.eI,{value:l.id.toString(),children:m({id:`global.${l.code}`,defaultMessage:l.name})},l.id))})},F=(0,L.xZ)`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,R=L.cp.div`
  animation: ${F} 2s infinite linear;
`,ns=()=>(0,t.jsx)(R,{children:(0,t.jsx)(M.c,{})})}}]);
